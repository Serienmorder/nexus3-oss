- name: Get current email info
  nexus_email_api:
    url: http://{{nexus_interaction_url}}
    endpoint_version: 'beta'
    url_username: "{{nexus_administrator_username}}"
    url_password: "{{current_nexus_admin_password}}"
    headers: 
      accept: "application/json"
    force_basic_auth: yes
    validate_certs: false
    method: GET
- name: Update Email info
  nexus_email_api:
    url: http://{{nexus_interaction_url}}
    endpoint_version: 'beta'
    url_username: "{{nexus_administrator_username}}"
    url_password: "{{current_nexus_admin_password}}"
    headers: 
      accept: "application/json"
    force_basic_auth: yes
    validate_certs: false
    method: PUT
    email_info:
      enabled: "{{ nexus_email_server_enabled }}"
      host: "{{ nexus_email_server_host }}"
      port: "{{ nexus_email_server_port }}"
      from_address: "{{ nexus_email_from_address }}"
      subject_prefix: "{{ nexus_email_subject_prefix }}"
      start_tls_enabled: "{{ nexus_email_tls_enabled }}"
      start_tls_required: "{{ nexus_email_tls_required }}"
      ssl_on_connect_enabled: "{{ nexus_email_ssl_on_connect_enabled }}"
      ssl_server_identity_check_enabled: "{{ nexus_email_ssl_check_server_identity_enabled }}"
      nexus_trust_store_enabled: "{{ nexus_email_trust_store_enabled }}"
      username: "{{ nexus_email_server_username }}"
      password: "{{ nexus_email_server_password }}"
- name: Test email
  nexus_email_api:
    url: http://{{nexus_interaction_url}}
    endpoint_version: 'beta'
    url_username: "{{nexus_administrator_username}}"
    url_password: "{{current_nexus_admin_password}}"
    headers: 
      accept: "application/json"
    force_basic_auth: yes
    validate_certs: false
    method: POST
    email_info:
      verify_address: "{{ nexus_email_verify_email_address }}"
  register: output
  failed_when: output.msg != 'verify email failed'
  when: real_email_config = false
- name: Delete Email info
  nexus_email_api:
    url: http://{{nexus_interaction_url}}
    endpoint_version: 'beta'
    url_username: "{{nexus_administrator_username}}"
    url_password: "{{current_nexus_admin_password}}"
    headers: 
      accept: "application/json"
    force_basic_auth: yes
    validate_certs: false
    method: DELETE